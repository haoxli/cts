{"version":3,"sources":["../../../../../../src/webgpu/api/validation/encoding/queries/general.spec.ts"],"names":["description","params","poptions","makeTestGroup","kQueryTypes","ValidationTest","g","test","desc","subcases","concat","unimplemented","cases","combine","type","fn","t","encoderType","queryIndex","selectDeviceForQueryTypeOrSkipTestCase","count","pipelineStatistics","querySet","device","createQuerySet","encoder","createEncoder","writeTimestamp","expectValidationError","finish","createQuerySetWithState"],"mappings":"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","sourcesContent":["export const description = `\nTODO:\n\n- Start a pipeline statistics query in all possible encoders:\n    - queryIndex {in, out of} range for GPUQuerySet\n    - GPUQuerySet {valid, invalid}\n    - x ={render pass, compute pass} encoder\n`;\n\nimport { params, poptions } from '../../../../../common/framework/params_builder.js';\nimport { makeTestGroup } from '../../../../../common/framework/test_group.js';\nimport { kQueryTypes } from '../../../../capability_info.js';\nimport { ValidationTest } from '../../validation_test.js';\n\nexport const g = makeTestGroup(ValidationTest);\n\ng.test('occlusion_query,query_type')\n  .desc(\n    `\nTests that set occlusion query set with all types in render pass descriptor:\n- type {occlusion (control case), pipeline statistics, timestamp}\n- {undefined} for occlusion query set in render pass descriptor\n  `\n  )\n  .subcases(() => poptions('type', ['undefined'].concat(kQueryTypes)))\n  .unimplemented();\n\ng.test('occlusion_query,invalid_query_set')\n  .desc(\n    `\nTests that begin occlusion query with a invalid query set that failed during creation.\n  `\n  )\n  .subcases(() => poptions('querySetState', ['valid', 'invalid'] as const))\n  .unimplemented();\n\ng.test('occlusion_query,query_index')\n  .desc(\n    `\nTests that begin occlusion query with query index:\n- queryIndex {in, out of} range for GPUQuerySet\n  `\n  )\n  .subcases(() => poptions('queryIndex', [0, 2]))\n  .unimplemented();\n\ng.test('timestamp_query,query_type_and_index')\n  .desc(\n    `\nTests that write timestamp to all types of query set on all possible encoders:\n- type {occlusion, pipeline statistics, timestamp}\n- queryIndex {in, out of} range for GPUQuerySet\n- x= {non-pass, compute, render} encoder\n  `\n  )\n  .cases(\n    params()\n      .combine(poptions('encoderType', ['non-pass', 'compute pass', 'render pass'] as const))\n      .combine(poptions('type', kQueryTypes))\n  )\n  .subcases(({ type }) => poptions('queryIndex', type === 'timestamp' ? [0, 2] : [0]))\n  .fn(async t => {\n    const { encoderType, type, queryIndex } = t.params;\n\n    await t.selectDeviceForQueryTypeOrSkipTestCase(type);\n\n    const count = 2;\n    const pipelineStatistics =\n      type === 'pipeline-statistics' ? (['clipper-invocations'] as const) : ([] as const);\n    const querySet = t.device.createQuerySet({ type, count, pipelineStatistics });\n\n    const encoder = t.createEncoder(encoderType);\n    encoder.encoder.writeTimestamp(querySet, queryIndex);\n\n    t.expectValidationError(() => {\n      encoder.finish();\n    }, type !== 'timestamp' || queryIndex >= count);\n  });\n\ng.test('timestamp_query,invalid_query_set')\n  .desc(\n    `\nTests that write timestamp to a invalid query set that failed during creation:\n- x= {non-pass, compute, render} enconder\n  `\n  )\n  .subcases(() => poptions('encoderType', ['non-pass', 'compute pass', 'render pass'] as const))\n  .fn(async t => {\n    const querySet = t.createQuerySetWithState('invalid');\n\n    const encoder = t.createEncoder(t.params.encoderType);\n    encoder.encoder.writeTimestamp(querySet, 0);\n\n    t.expectValidationError(() => {\n      encoder.finish();\n    });\n  });\n"],"file":"general.spec.js"}